(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4019:(e,s,r)=>{Promise.resolve().then(r.bind(r,6716))},5928:(e,s,r)=>{"use strict";r.d(s,{XI:()=>i,dg:()=>a});var l=r(3776),t=r(5452);let a=(0,t.createContext)({hasPermission:()=>!1,setPermissions:()=>{},permissions:[]}),o=["upload","delete","view"],n=e=>(Array.isArray(e)||(e=[e]),o.filter(s=>!e.includes(s))),i=e=>{let{children:s}=e,[r,o]=(0,t.useState)([]),i=e=>{o(e)};return(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/connect");(await e.json()).ok?i(n([])):i(n(["delete"]))}catch(e){console.log(e.stack),i(n(["delete"]))}})()},[]),(0,l.jsx)(a.Provider,{value:{hasPermission:e=>r.includes(e),setPermissions:i,permissions:r},children:s})}},6716:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>O});var l=r(3776),t=r(5452),a=r(1392),o=r(7736),n=r(9055),i=r(429),c=r.n(i),d=r(2506);let h=JSON.parse('{"rE":"0.0.10","h_":"Support for multiple file types and sizes"}'),m={name:"File Uploader",description:h.h_,version:h.rE};var x=r(6829),f=r(4302);let p=()=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(x.default,{src:"/images/file-uploader.png",alt:"Logo",width:32,height:32,className:"filter brightness-400"}),(0,l.jsx)("h1",{className:"text-xl font-bold",children:"File Uploader"})]}),(0,l.jsxs)("p",{className:"text-xs",children:["Version: ",m.version," by"," ",(0,l.jsx)("a",{className:"hover:underline font-bold",href:"https://github.com/Mela-Digital",target:"_blank",children:"@Mela Digital"})]})]}),u=()=>{let[e,s]=(0,t.useState)(!1),r=()=>{s(e=>!e)};return(0,l.jsxs)("header",{className:"bg-primary text-white",children:[(0,l.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,l.jsx)(p,{}),(0,l.jsx)("nav",{className:"hidden md:flex space-x-4",children:(0,l.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,l.jsx)(f.hL4,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"GitHub"})]})}),(0,l.jsx)("button",{className:"md:hidden text-white focus:outline-none",onClick:r,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]}),(0,l.jsxs)("div",{className:"md:hidden fixed top-0 left-0 w-full h-full bg-primary text-white p-4 z-50 transform transition-transform duration-300 ".concat(e?"translate-x-0":"-translate-x-full"),children:[(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsx)(p,{})}),(0,l.jsx)("button",{className:"absolute top-4 right-4 text-white focus:outline-none",onClick:r,children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,l.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,l.jsx)(f.hL4,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"GitHub"})]})]})]})};var g=r(4408),j=r(5261),v=r(9339),w=r(388);let b=()=>{let[e,s]=(0,t.useState)("");return((0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/connect"),r=await e.json();(null==r?void 0:r.ipAddress)&&s(r.ipAddress)}catch(e){console.error("Failed to fetch IP address:",e)}})()},[]),e)?(0,l.jsx)(v.r,{id:"qrCode",removeQrCodeBehindLogo:!0,logoPadding:0,value:"http://".concat(e,":").concat(document.location.port),logoImage:"/images/file-uploader.png",eyeRadius:7,logoPaddingStyle:"circle",qrStyle:"dots",size:100,logoWidth:22}):(0,l.jsx)(w.o,{})},N=e=>{let{handleUpload:s,clearUploadedFiles:r,clearAllFiles:t,isUploading:a,selectedFiles:n}=e;return(0,l.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,l.jsx)(o.T,{onPress:s,isLoading:a,isDisabled:a||n.every(e=>e.isUploaded),color:"primary",startContent:(0,l.jsx)(f.HVe,{}),children:a?"Uploading...":"Upload"}),(0,l.jsx)(o.T,{color:"warning",startContent:(0,l.jsx)(f.Gml,{}),className:"text-white",onPress:r,children:"Clear Uploaded"}),(0,l.jsx)(o.T,{color:"danger",startContent:(0,l.jsx)(f.RCe,{}),onPress:t,children:"Clear All"})]})},y=e=>{let{isDragging:s,handleDragEnter:r,handleDragLeave:t,handleDragOver:a,handleDrop:o,handleFileSelect:i}=e;return(0,l.jsx)("div",{className:"flex w-full flex-col",children:(0,l.jsxs)(g.r,{"aria-label":"Options",className:"w-full",color:"primary",classNames:{base:"justify-center"},children:[(0,l.jsx)(j.i,{title:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(n.ODX,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"File Upload"})]}),children:(0,l.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto hover:border-primary-400 ".concat(s?"border-blue-500 bg-blue-100":"border-gray-300"),onDragEnter:r,onDragLeave:t,onDragOver:a,onDrop:o,children:[(0,l.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500",children:[(0,l.jsx)("p",{className:"text-gray-600",children:s?"Drop files here...":"Drag and drop files here, or"}),(0,l.jsx)("div",{className:"mx-auto my-4 w-16 h-16",children:(0,l.jsx)(x.default,{src:"/images/file-uploader.png",alt:"File upload illustration",width:64,height:64})}),"browse files"]}),(0,l.jsx)("input",{id:"file-upload",type:"file",className:"hidden",onChange:i,multiple:!0})]})},"fileUpload"),(0,l.jsx)(j.i,{title:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(n.lWy,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"QR Code"})]}),children:(0,l.jsxs)("div",{className:"border-2 border-dashed border-primary-400 rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto",children:[(0,l.jsx)("p",{className:"text-gray-600",children:"Scan the QR code below to connect"}),(0,l.jsx)("div",{className:"mx-auto my-4 flex items-center justify-center w-32 h-32",children:(0,l.jsx)(b,{})})]})},"qr")]})})};var D=r(1712),E=r(1701);let P=e=>e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase());function F(e,s){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return s<=0?"":e.length>s?"".concat(r).concat(e.slice(-s)):e}function k(e){if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024)),r=e/Math.pow(1024,s);return"".concat(r.toFixed(2)," ").concat(["Bytes","KB","MB","GB","TB"][s])}let C=e=>{let{files:s,removeFile:r}=e;return(0,l.jsx)("ul",{className:"space-y-4",children:s.map((e,s)=>(0,l.jsxs)("li",{className:"p-2 bg-gray-100 rounded shadow text-gray-700",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"font-medium text-sm text-gray-700",children:F(e.file.name,12)}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:k(e.file.size)})]}),(0,l.jsx)(o.T,{isIconOnly:!0,startContent:(0,l.jsx)(E.cW1,{className:"w-6 h-6"}),color:"danger",variant:"faded",onPress:()=>r(e.file.name),className:"p-0 min-w-0 w-auto h-auto rounded-full border-0"})]}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)(D.o,{"aria-label":"Loading...",size:"sm",value:e.progress}),(0,l.jsxs)("p",{className:"text-right text-xs text-gray-600",children:[e.progress,"%"]})]})]},s))})},S=()=>{let[e,s]=(0,t.useState)(!1),[r,a]=(0,t.useState)([]),[o,n]=(0,t.useState)(!1),i=(0,t.useRef)(0),c=e=>{a(s=>{let r=new Set(s.map(e=>e.file.name));return[...e.filter(e=>!r.has(e.name)).map(e=>({file:e,progress:0})),...s]})},d=(0,t.useRef)(new Map),h=async()=>{if(0===r.length)return;n(!0);let e=r.map(e=>e.isUploaded?Promise.resolve():new Promise((s,r)=>{let l=e.file;fetch("/api/get-file-name?originalName="+encodeURIComponent(l.name)).then(e=>e.json()).then(e=>{let t=new XMLHttpRequest;d.current.set(l.name,t),t.open("PUT","/api/upload-file?fileName="+e.filename,!0),t.upload.onprogress=function(s){if(s.lengthComputable){let r=s.loaded/s.total*100;a(s=>s.map(s=>s.file.name===l.name?{...s,progress:Math.round(r),serverFilename:e.filename}:s))}},t.onload=function(){d.current.delete(l.name),200===t.status?(console.log("File ".concat(l.name," uploaded successfully!")),a(e=>e.map(e=>e.file.name===l.name?{...e,isUploaded:!0}:e)),s()):(console.log("File ".concat(l.name," upload failed!")),r()),0===d.current.size&&n(!1)},t.onerror=function(){d.current.delete(l.name),console.log("Error occurred while uploading ".concat(l.name,".")),r(),0===d.current.size&&n(!1)},t.send(l)}).catch(e=>{console.error("Error preparing upload for ".concat(l.name,":"),e),r(),0===d.current.size&&n(!1)})}));try{await Promise.all(e),console.log("All files uploaded successfully!")}catch(e){console.error("Some files failed to upload:",e)}};return(0,l.jsxs)("div",{children:[(0,l.jsx)(y,{handleDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i.current+=1,s(!0)},handleDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i.current-=1,0===i.current&&s(!1)},handleDragOver:e=>{e.preventDefault(),e.stopPropagation()},handleDrop:e=>{e.preventDefault(),e.stopPropagation(),s(!1);let r=Array.from(e.dataTransfer.files);c(r),console.log("Dropped files:",r)},handleFileSelect:e=>{let s=Array.from(e.target.files||[]);c(s),console.log("Selected files:",s),e.target.value=""},isDragging:e}),(0,l.jsx)("div",{className:"mt-4 h-full overflow-y-auto",children:r.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C,{files:r,removeFile:e=>{let s=d.current.get(e);if(s){var l;s.abort(),d.current.delete(e),console.log("Upload for file ".concat(e," aborted."));let t=null===(l=r.find(s=>s.file.name===e))||void 0===l?void 0:l.serverFilename;t&&fetch("/api/upload-file?fileName="+encodeURIComponent(t),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(t," removed from the server.")):console.error("Failed to remove file ".concat(t," from the server."))}).catch(e=>{console.error("Error removing file ".concat(t," from the server:"),e)})}a(s=>{let r=s.filter(s=>s.file.name!==e);return(0===r.length||0===d.current.size)&&n(!1),r})}}),(0,l.jsx)(N,{handleUpload:h,clearUploadedFiles:()=>{a(e=>e.filter(e=>!e.isUploaded))},clearAllFiles:()=>{d.current.forEach((e,s)=>{var l;let t=null===(l=r.find(e=>e.file.name===s))||void 0===l?void 0:l.serverFilename;t&&fetch("/api/upload-file?fileName="+encodeURIComponent(t),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(t," removed from the server.")):console.error("Failed to remove file ".concat(t," from the server."))}).catch(e=>{console.error("Error removing file ".concat(t," from the server:"),e)}),e.abort()}),d.current.clear(),a([]),n(!1)},isUploading:o,selectedFiles:r})]})})]})},M=()=>(0,l.jsxs)("p",{children:["Visit our"," ",(0,l.jsx)("a",{href:"https://github.com/Mela-Digital/file-uploader/tags",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]}),U=e=>{let{currentVersion:s,latestVersion:r}=e,t=s<r,a=s>r;return(0,l.jsxs)(l.Fragment,{children:[t&&(0,l.jsxs)("div",{className:"bg-yellow-500 text-white p-4 text-center",children:[(0,l.jsxs)("p",{children:["A new version of the app is available! You are using version"," ",(0,l.jsx)("strong",{children:s}),", but the latest version is"," ",(0,l.jsx)("strong",{children:r}),"."]}),(0,l.jsx)(M,{})]}),a&&(0,l.jsxs)("div",{className:"bg-red-500 text-white p-4 text-center",children:[(0,l.jsxs)("p",{children:["You are using an invalid version of the app (",(0,l.jsx)("strong",{children:s}),"). Please reinstall the app to get the latest official version (",(0,l.jsx)("strong",{children:r}),")."]}),(0,l.jsx)(M,{})]})]})};var L=r(9756);let T=e=>L.c9.fromISO(e).toRelative();var _=r(5928);let A=e=>{let s=e.toLowerCase();return[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(e=>s.endsWith(e))},O=()=>{let[e,s]=(0,t.useState)([]),[r,i]=(0,t.useState)(1),[h,x]=(0,t.useState)(1),[f,p]=(0,t.useState)(m.version),{hasPermission:g,permissions:j}=(0,t.useContext)(_.dg),v=g("delete");(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("https://api.github.com/repos/Mela-Digital/file-uploader/tags");if(e.ok){let s=await e.json();s.length>0&&p(s[0].name)}else console.error("Failed to fetch the latest version")}catch(e){console.error("Error fetching the latest version:",e)}})()},[]),(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/files?page=".concat(r,"&limit=10"));if(e.ok){let r=await e.json();s(r.files),x(r.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()},[r]);let w=e=>{i(e)},b=async l=>{try{if((await fetch("/api/files/".concat(l),{method:"DELETE"})).ok){let t=e.filter(e=>e.name!==l);s(t),0===t.length&&r>1?i(r-1):(async()=>{try{let e=await fetch("/api/files?page=".concat(r,"&limit=10"));if(e.ok){let r=await e.json();s(r.files),x(r.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()}else console.error("Failed to delete file")}catch(e){console.error("Error deleting file:",e)}};return(0,l.jsxs)("div",{className:"bg-white h-screen flex flex-col overflow-hidden",children:[(0,l.jsx)(u,{}),(0,l.jsx)(U,{currentVersion:m.version,latestVersion:f}),(0,l.jsx)("div",{className:"container px-4 mx-auto my-4",children:(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsx)("span",{className:"font-semibold",children:"Your permissions:"})," ".concat(j.map(e=>P(e)).join(", "))]})}),(0,l.jsx)("div",{className:"flex-1 w-full xl:container mx-auto p-4 overflow-hidden",children:(0,l.jsxs)("div",{className:"flex h-full w-full rounded-lg overflow-hidden shadow-lg border border-gray-200 flex-col md:flex-row",children:[(0,l.jsx)("div",{className:"w-full md:w-1/3 lg:w-1/4 p-4 border-b md:border-b-0 md:border-r border-gray-200 bg-gray-50 overflow-y-auto",children:(0,l.jsx)(S,{})}),(0,l.jsxs)("div",{className:"flex-1 p-4 bg-white overflow-y-auto",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Browse Your Files"}),(0,l.jsx)("ul",{className:"space-y-4",children:e.map((e,s)=>(0,l.jsxs)("li",{className:"p-4 bg-gray-100 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-200 gap-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[A(e.name)?(0,l.jsx)("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 rounded-md",children:(0,l.jsx)(a.W,{className:"w-12 h-12 object-cover",isZoomed:!0,radius:"md",src:"/api/download/".concat(e.name),alt:"Preview image"})}):(0,l.jsx)("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 rounded-md border border-primary-200 group",children:(0,l.jsx)("p",{className:"text-xs font-bold text-primary-500 group-hover:scale-125 group-hover:duration-300 transform",children:function(e){let s=e.split(".");return s.length>1&&s.pop()||""}(e.name)})}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"font-medium text-sm text-gray-700",children:F(e.name,12)}),(0,l.jsxs)("p",{className:"text-xs text-gray-400",children:[k(e.size)," -"," ",T(e.createdAt)]})]})]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(o.T,{isIconOnly:!0,isDisabled:!v,onPress:v?()=>b(e.name):void 0,color:"danger",children:(0,l.jsx)(n.Tqh,{className:"w-6 h-6"})}),(0,l.jsx)(o.T,{isIconOnly:!0,color:"primary",as:c(),href:"/api/download/".concat(e.name),rel:"noopener noreferrer",download:!0,children:(0,l.jsx)(n.kvS,{className:"w-6 h-6"})})]})]},s))}),!!e.length&&(0,l.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,l.jsx)(o.T,{onPress:()=>{r>1&&i(r-1)},isDisabled:1===r,startContent:(0,l.jsx)(d.YvZ,{className:"w-5 h-5"}),children:"Previous"}),(()=>{let e=[],s=Math.max(1,r-1),l=Math.min(h,r+1);for(let r=s;r<=l;r++)e.push(r);return e.length<3&&(e[0]>1?e.unshift(e[0]-1):e[e.length-1]<h&&e.push(e[e.length-1]+1)),e})().map(e=>(0,l.jsx)(o.T,{onPress:()=>w(e),isIconOnly:!0,color:r===e?"primary":"default",children:e},e)),(0,l.jsx)(o.T,{onPress:()=>{r<h&&i(r+1)},isDisabled:r===h,endContent:(0,l.jsx)(d.B_2,{className:"w-5 h-5"}),children:"Next"})]})]})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[789,196,581,148,52,799,494,736,835,358],()=>s(4019)),_N_E=e.O()}]);