(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{603:(e,s,r)=>{"use strict";r.d(s,{Jj:()=>n,aX:()=>l,es:()=>t,uB:()=>a});let t={LATEST_VERSION:"latestVersion",FILES:"files",DELETE_FILE:"deleteFile"},a={DEFAULT_STALE_TIME:6e4,CHECKING_LATEST_VERSION:6e5};var l=function(e){return e.READ="read",e.WRITE="write",e.DELETE="delete",e.UPLOAD="upload",e}({});let n=["read","write","delete","upload"]},2176:(e,s,r)=>{"use strict";r.d(s,{XI:()=>o,dg:()=>n});var t=r(2694),a=r(3478),l=r(603);let n=(0,a.createContext)({hasPermission:()=>!1,setPermissions:()=>{},permissions:[]}),i=e=>(Array.isArray(e)||(e=[e]),l.Jj.filter(s=>!e.includes(s))),o=e=>{let{children:s}=e,[r,o]=(0,a.useState)([]),c=e=>{o(e)};return(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/connect");(await e.json()).ok?c(i([])):c(i([l.aX.DELETE]))}catch(e){console.log(e.stack),c(i([l.aX.DELETE]))}})()},[]),(0,t.jsx)(n.Provider,{value:{hasPermission:e=>r.includes(e),setPermissions:c,permissions:r},children:s})}},4663:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>X});var t=r(2694),a=r(3478),l=r(2849),n=r(7028),i=r(1387),o=r(5371),c=r(603),d=r(3431),h=r(9630);let m=()=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.default,{src:"/images/file-uploader.png",alt:"Logo",width:32,height:32,className:"filter brightness-400"}),(0,t.jsx)("h1",{className:"text-xl font-bold",children:"File Uploader"})]}),(0,t.jsxs)("p",{className:"text-xs",children:["Version: ",o.e.version," by"," ",(0,t.jsx)("a",{className:"hover:underline font-bold",href:"https://github.com/Mela-Digital",target:"_blank",children:"@Mela Digital"})]})]}),u=()=>{let[e,s]=(0,a.useState)(!1),r=()=>{s(e=>!e)};return(0,t.jsxs)("header",{className:"bg-primary text-white",children:[(0,t.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,t.jsx)(m,{}),(0,t.jsx)("nav",{className:"hidden md:flex space-x-4",children:(0,t.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,t.jsx)(h.hL4,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"GitHub"})]})}),(0,t.jsx)("button",{className:"md:hidden text-white focus:outline-none",onClick:r,children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]}),(0,t.jsxs)("div",{className:"md:hidden fixed top-0 left-0 w-full h-full bg-primary text-white p-4 z-50 transform transition-transform duration-300 ".concat(e?"translate-x-0":"-translate-x-full"),children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)(m,{})}),(0,t.jsx)("button",{className:"absolute top-4 right-4 text-white focus:outline-none",onClick:r,children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,t.jsx)(h.hL4,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"GitHub"})]})]})]})};var x=r(7087),f=r(1143),p=r(467),g=r(9087),j=r(5622),v=r(1381);let w=()=>{let[e,s]=(0,a.useState)("");return((0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/connect"),r=await e.json();(null==r?void 0:r.ipAddress)&&s(r.ipAddress)}catch(e){console.error("Failed to fetch IP address:",e)}})()},[]),e)?(0,t.jsx)(j.r,{id:"qrCode",removeQrCodeBehindLogo:!0,logoPadding:0,value:"http://".concat(e,":").concat(document.location.port),logoImage:"/images/file-uploader.png",eyeRadius:7,logoPaddingStyle:"circle",qrStyle:"dots",size:100,logoWidth:22}):(0,t.jsx)(v.o,{})},y=e=>{let{handleUpload:s,clearUploadedFiles:r,clearAllFiles:a,isUploading:l,selectedFiles:n}=e;return(0,t.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,t.jsx)(f.T,{onPress:s,isLoading:l,isDisabled:l||n.every(e=>e.isUploaded),color:"primary",startContent:(0,t.jsx)(h.HVe,{}),children:l?"Uploading...":"Upload"}),(0,t.jsx)(f.T,{color:"warning",startContent:(0,t.jsx)(h.Gml,{}),className:"text-white",onPress:r,children:"Clear Uploaded"}),(0,t.jsx)(f.T,{color:"danger",startContent:(0,t.jsx)(h.RCe,{}),onPress:a,children:"Clear All"})]})},N=e=>{let{isDragging:s,handleDragEnter:r,handleDragLeave:a,handleDragOver:l,handleDrop:n,handleFileSelect:i}=e;return(0,t.jsx)("div",{className:"flex w-full flex-col",children:(0,t.jsxs)(p.r,{"aria-label":"Options",className:"w-full",color:"primary",classNames:{base:"justify-center"},children:[(0,t.jsx)(g.i,{title:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.ODX,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"File Upload"})]}),children:(0,t.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500",children:(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto hover:border-primary-400 ".concat(s?"border-blue-500 bg-blue-100":"border-gray-300"),onDragEnter:r,onDragLeave:a,onDragOver:l,onDrop:n,children:[(0,t.jsx)("p",{className:"text-gray-600",children:s?"Drop files here...":"Drag and drop files here, or"}),(0,t.jsx)("div",{className:"mx-auto my-4 w-16 h-16",children:(0,t.jsx)(d.default,{src:"/images/file-uploader.png",alt:"File upload illustration",width:64,height:64})}),"browse files",(0,t.jsx)("input",{id:"file-upload",type:"file",className:"hidden",onChange:i,multiple:!0})]})})},"fileUpload"),(0,t.jsx)(g.i,{title:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.lWy,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"QR Code"})]}),children:(0,t.jsxs)("div",{className:"border-2 border-dashed border-primary-400 rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto",children:[(0,t.jsx)("p",{className:"text-gray-600",children:"Scan the QR code below to connect"}),(0,t.jsx)("div",{className:"mx-auto my-4 flex items-center justify-center w-32 h-32",children:(0,t.jsx)(w,{})})]})},"qr")]})})};var b=r(3986),E=r(7381);let D=e=>e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase());function L(e,s){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return s<=0?"":e.length>s?"".concat(r).concat(e.slice(-s)):e}function F(e){if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024)),r=e/Math.pow(1024,s);return"".concat(r.toFixed(2)," ").concat(["Bytes","KB","MB","GB","TB"][s])}let P=e=>{let{files:s,removeFile:r}=e;return(0,t.jsx)("ul",{className:"space-y-4",children:s.map((e,s)=>(0,t.jsxs)("li",{className:"p-2 bg-gray-100 rounded shadow text-gray-700",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-sm text-gray-700",children:L(e.file.name,12)}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:F(e.file.size)})]}),(0,t.jsx)(f.T,{isIconOnly:!0,startContent:(0,t.jsx)(E.cW1,{className:"w-6 h-6"}),color:"danger",variant:"faded",onPress:()=>r(e.file.name),className:"p-0 min-w-0 w-auto h-auto rounded-full border-0"})]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)(b.o,{"aria-label":"Loading...",size:"sm",value:e.progress}),(0,t.jsxs)("p",{className:"text-right text-xs text-gray-600",children:[e.progress,"%"]})]})]},s))})},T=e=>{let{refreshFiles:s}=e,[r,l]=(0,a.useState)(!1),[n,i]=(0,a.useState)([]),[o,c]=(0,a.useState)(!1),d=(0,a.useRef)(0),h=e=>{i(s=>{let r=new Set(s.map(e=>e.file.name));return[...e.filter(e=>!r.has(e.name)).map(e=>({file:e,progress:0})),...s]})},m=(0,a.useRef)(new Map),u=async()=>{if(0===n.length)return;c(!0);let e=n.map(e=>e.isUploaded?Promise.resolve():new Promise((s,r)=>{let t=e.file;fetch("/api/get-file-name?originalName="+encodeURIComponent(t.name)).then(e=>e.json()).then(e=>{let a=new XMLHttpRequest;m.current.set(t.name,a),a.open("PUT","/api/upload-file?fileName="+e.filename,!0),a.upload.onprogress=function(s){if(s.lengthComputable){let r=s.loaded/s.total*100;i(s=>s.map(s=>s.file.name===t.name?{...s,progress:Math.round(r),serverFilename:e.filename}:s))}},a.onload=function(){m.current.delete(t.name),200===a.status?(console.log("File ".concat(t.name," uploaded successfully!")),i(e=>e.map(e=>e.file.name===t.name?{...e,isUploaded:!0}:e)),s()):(console.log("File ".concat(t.name," upload failed!")),r()),0===m.current.size&&c(!1)},a.onerror=function(){m.current.delete(t.name),console.log("Error occurred while uploading ".concat(t.name,".")),r(),0===m.current.size&&c(!1)},a.send(t)}).catch(e=>{console.error("Error preparing upload for ".concat(t.name,":"),e),r(),0===m.current.size&&c(!1)})}));try{await Promise.all(e)}catch(e){console.error("Some files failed to upload:",e)}finally{s()}};return(0,t.jsxs)("div",{children:[(0,t.jsx)(N,{handleDragEnter:e=>{e.preventDefault(),e.stopPropagation(),d.current+=1,l(!0)},handleDragLeave:e=>{e.preventDefault(),e.stopPropagation(),d.current-=1,0===d.current&&l(!1)},handleDragOver:e=>{e.preventDefault(),e.stopPropagation()},handleDrop:e=>{e.preventDefault(),e.stopPropagation(),l(!1);let s=Array.from(e.dataTransfer.files);h(s),console.log("Dropped files:",s)},handleFileSelect:e=>{h(Array.from(e.target.files||[])),e.target.value=""},isDragging:r}),(0,t.jsx)("div",{className:"mt-4 h-full overflow-y-auto",children:n.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P,{files:n,removeFile:e=>{let s=m.current.get(e);if(s){var r;s.abort(),m.current.delete(e);let t=null===(r=n.find(s=>s.file.name===e))||void 0===r?void 0:r.serverFilename;t&&fetch("/api/upload-file?fileName="+encodeURIComponent(t),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(t," removed from the server.")):console.error("Failed to remove file ".concat(t," from the server."))}).catch(e=>{console.error("Error removing file ".concat(t," from the server:"),e)})}i(s=>{let r=s.filter(s=>s.file.name!==e);return(0===r.length||0===m.current.size)&&c(!1),r})}}),(0,t.jsx)(y,{handleUpload:u,clearUploadedFiles:()=>{i(e=>e.filter(e=>!e.isUploaded))},clearAllFiles:()=>{m.current.forEach((e,s)=>{var r;let t=null===(r=n.find(e=>e.file.name===s))||void 0===r?void 0:r.serverFilename;t&&fetch("/api/upload-file?fileName="+encodeURIComponent(t),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(t," removed from the server.")):console.error("Failed to remove file ".concat(t," from the server."))}).catch(e=>{console.error("Error removing file ".concat(t," from the server:"),e)}),e.abort()}),m.current.clear(),i([]),c(!1)},isUploading:o,selectedFiles:n})]})})]})},C=()=>(0,t.jsxs)("p",{children:["Visit our"," ",(0,t.jsx)("a",{href:"https://github.com/Mela-Digital/file-uploader/tags",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]}),S=e=>{let{currentVersion:s,latestVersion:r,isChecking:a}=e,l=s<r,n=s>r;return a?null:(0,t.jsxs)(t.Fragment,{children:[l&&(0,t.jsxs)("div",{className:"bg-yellow-500 text-white p-4 text-center",children:[(0,t.jsxs)("p",{children:["A new version of the app is available! You are using version"," ",(0,t.jsx)("strong",{children:s}),", but the latest version is"," ",(0,t.jsx)("strong",{children:r}),"."]}),(0,t.jsx)(C,{})]}),n&&(0,t.jsxs)("div",{className:"bg-red-500 text-white p-4 text-center",children:[(0,t.jsxs)("p",{children:["You are using an invalid version of the app (",(0,t.jsx)("strong",{children:s}),"). Please reinstall the app to get the latest official version (",(0,t.jsx)("strong",{children:r}),")."]}),(0,t.jsx)(C,{})]})]})},I=e=>{let{permissions:s}=e;return(0,t.jsx)("div",{className:"container px-4 mx-auto my-4",children:(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Your permissions:"})," ".concat(s.map(e=>D(e)).join(", "))]})})};var k=r(8533),_=r(7515),U=r.n(_);let M=e=>{let s=e.toLowerCase();return[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(e=>s.endsWith(e))};var R=r(796);let A=e=>R.c9.fromISO(e).toRelative(),O=e=>{let{file:s,isLoading:r,canDelete:a,handleDeleteFile:l}=e;return(0,t.jsxs)("li",{className:"p-4 bg-gray-100 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-200 gap-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[M(s.name)?(0,t.jsx)("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 rounded-md",children:(0,t.jsx)(k.W,{className:"w-12 h-12 object-cover",isZoomed:!0,radius:"md",src:"/api/download/".concat(s.name),alt:"Preview image"})}):(0,t.jsx)("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 rounded-md border border-primary-200 group",children:(0,t.jsx)("p",{className:"text-xs font-bold text-primary-500 group-hover:scale-125 group-hover:duration-300 transform",children:function(e){let s=e.split(".");return s.length>1&&s.pop()||""}(s.name)})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-sm text-gray-700",children:L(s.name,12)}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[F(s.size)," - ",A(s.createdAt)]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(f.T,{isIconOnly:!0,isDisabled:!a,isLoading:r,onPress:a?()=>l(s.name):void 0,color:"danger",children:(0,t.jsx)(x.Tqh,{className:"w-6 h-6"})}),(0,t.jsx)(f.T,{isIconOnly:!0,color:"primary",as:U(),href:"/api/download/".concat(s.name),rel:"noopener noreferrer",download:!0,children:(0,t.jsx)(x.kvS,{className:"w-6 h-6"})})]})]})};var B=r(8426);let V=e=>{let{handleNextPage:s,handlePageChange:r,handlePreviousPage:a,page:l,totalPages:n}=e;return(0,t.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,t.jsx)(f.T,{onPress:a,isDisabled:1===l,startContent:(0,t.jsx)(B.YvZ,{className:"w-5 h-5"}),isIconOnly:!0}),(()=>{let e=[],s=Math.max(1,l-1),r=Math.min(n,l+1);for(let t=s;t<=r;t++)e.push(t);return e.length<3&&(e[0]>1?e.unshift(e[0]-1):e[e.length-1]<n&&e.push(e[e.length-1]+1)),e})().map(e=>(0,t.jsx)(f.T,{onPress:()=>r(e),isIconOnly:!0,color:l===e?"primary":"default",children:e},e)),(0,t.jsx)(f.T,{onPress:s,isDisabled:l===n,endContent:(0,t.jsx)(B.B_2,{className:"w-5 h-5"}),isIconOnly:!0})]})};var q=r(6718);let z=(0,q.createServerReference)("7fe41fc3360316354356240c3c9965911b8000cd59",q.callServer,void 0,q.findSourceMapURL,"getLatestVersion"),W=async e=>{try{let s=await fetch("/api/files?page=".concat(e,"&limit=10"));if(!s.ok)return console.error("Failed to fetch files"),{files:[],totalPages:0};{let e=await s.json();return{files:e.files,totalPages:e.totalPages}}}catch(e){return console.error("Error fetching files:",e),{files:[],totalPages:0}}},G=async e=>{try{return(await fetch("/api/files/".concat(e),{method:"DELETE"})).ok}catch(e){return console.error("Error deleting file:",e),!1}};var H=r(2176);let K=()=>{let{hasPermission:e,permissions:s}=(0,a.useContext)(H.dg);return{hasPermission:e,permissions:s}},X=()=>{let[e,s]=(0,a.useState)(1),{hasPermission:r,permissions:d}=K(),h=(0,l.jE)(),m=(0,a.useRef)(""),{data:x,isFetching:f}=(0,n.I)({queryKey:[c.es.LATEST_VERSION],staleTime:c.uB.CHECKING_LATEST_VERSION,queryFn:z}),{data:p}=(0,n.I)({queryKey:[c.es.FILES,e],queryFn:async()=>await W(e),staleTime:0}),{mutateAsync:g,isPending:j}=(0,i.n)({mutationKey:[c.es.DELETE_FILE],mutationFn:async e=>{let{fileName:s}=e;return await G(s)}}),v=(null==p?void 0:p.files)||[],w=(null==p?void 0:p.totalPages)||1,y=r(c.aX.DELETE),N=()=>{h.invalidateQueries({queryKey:[c.es.FILES,e]})},b=async e=>{m.current=e,await g({fileName:e})&&N(),m.current=""};return(0,t.jsxs)("div",{className:"bg-white h-screen flex flex-col md:overflow-hidden",children:[(0,t.jsx)(u,{}),(0,t.jsx)(S,{currentVersion:o.e.version,latestVersion:x,isChecking:f}),(0,t.jsx)(I,{permissions:d}),(0,t.jsx)("div",{className:"flex-1 w-full xl:container mx-auto p-4 md:overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full w-full rounded-lg md:overflow-hidden shadow-lg border border-gray-200 flex-col md:flex-row",children:[(0,t.jsx)("div",{className:"w-full md:w-1/3 lg:w-1/4 p-4 border-b md:border-b-0 md:border-r border-gray-200 bg-gray-50 md:overflow-y-auto",children:(0,t.jsx)(T,{refreshFiles:N})}),(0,t.jsxs)("div",{className:"flex-1 p-4 bg-white md:overflow-y-auto",children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Browse Your Files"}),(0,t.jsx)("ul",{className:"space-y-4",children:v.map((e,s)=>{let r=m.current===e.name&&j;return(0,t.jsx)(O,{file:e,isLoading:r,canDelete:y,handleDeleteFile:b},s)})}),!!v.length&&(0,t.jsx)(V,{handleNextPage:()=>{e<w&&s(e+1)},handlePageChange:e=>s(e),handlePreviousPage:()=>{e>1&&s(e-1)},page:e,totalPages:w})]})]})})]})}},5371:(e,s,r)=>{"use strict";r.d(s,{e:()=>a});let t=JSON.parse('{"rE":"0.0.12","h_":"Support for multiple file types and sizes"}'),a={name:"File Uploader",description:t.h_,version:t.rE}},9537:(e,s,r)=>{Promise.resolve().then(r.bind(r,4663))}},e=>{var s=s=>e(e.s=s);e.O(0,[789,196,581,148,52,345,206,223,429,358],()=>s(9537)),_N_E=e.O()}]);