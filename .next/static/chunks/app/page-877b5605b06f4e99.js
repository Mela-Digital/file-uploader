(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7276:(e,l,r)=>{"use strict";r.r(l),r.d(l,{default:()=>C});var s=r(2694),t=r(3478),a=r(8533),n=r(8260),o=r(7087),i=r(7515),c=r.n(i);let d=JSON.parse('{"rE":"0.0.5","h_":"Support for multiple file types and sizes"}'),h={name:"File Uploader",description:d.h_,version:d.rE};var m=r(3431),f=r(9630);let x=()=>{let[e,l]=(0,t.useState)(!1),r=()=>{l(e=>!e)};return(0,s.jsxs)("header",{className:"bg-primary text-white",children:[(0,s.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.default,{src:"/images/file-uploader.png",alt:"Logo",width:32,height:32,className:"filter brightness-400"}),(0,s.jsx)("h1",{className:"text-xl font-bold",children:"File Uploader"})]}),(0,s.jsxs)("p",{className:"text-xs",children:["Version: ",h.version," by"," ",(0,s.jsx)("a",{className:"hover:underline font-bold",href:"https://github.com/Mela-Digital",target:"_blank",children:"@Mela Digital"})]})]}),(0,s.jsx)("nav",{className:"hidden md:flex space-x-4",children:(0,s.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,s.jsx)(f.hL4,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"GitHub"})]})}),(0,s.jsx)("button",{className:"md:hidden text-white focus:outline-none",onClick:r,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]}),(0,s.jsxs)("div",{className:"md:hidden fixed top-0 left-0 w-full h-full bg-primary text-white p-4 z-50 transform transition-transform duration-300 ".concat(e?"translate-x-0":"-translate-x-full"),children:[(0,s.jsx)("button",{className:"absolute top-4 right-4 text-white focus:outline-none",onClick:r,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,s.jsx)(f.hL4,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"GitHub"})]})]})]})},p=e=>{let{handleUpload:l,clearUploadedFiles:r,clearAllFiles:t,isUploading:a,selectedFiles:o}=e;return(0,s.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,s.jsx)(n.T,{onPress:l,isLoading:a,isDisabled:a||o.every(e=>e.isUploaded),color:"primary",startContent:(0,s.jsx)(f.HVe,{}),children:a?"Uploading...":"Upload"}),(0,s.jsx)(n.T,{color:"warning",startContent:(0,s.jsx)(f.Gml,{}),className:"text-white",onPress:r,children:"Clear Uploaded"}),(0,s.jsx)(n.T,{color:"danger",startContent:(0,s.jsx)(f.RCe,{}),onPress:t,children:"Clear All"})]})},u=e=>{let{isDragging:l,handleDragEnter:r,handleDragLeave:t,handleDragOver:a,handleDrop:n,handleFileSelect:o}=e;return(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto ".concat(l?"border-blue-500 bg-blue-100":"border-gray-300"),onDragEnter:r,onDragLeave:t,onDragOver:a,onDrop:n,children:[(0,s.jsx)("p",{className:"text-gray-600",children:l?"Drop files here...":"Drag and drop files here, or"}),(0,s.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500 hover:underline",children:[(0,s.jsx)("div",{className:"mx-auto my-4 w-16 h-16",children:(0,s.jsx)(m.default,{src:"/images/file-uploader.png",alt:"File upload illustration",width:64,height:64})}),"browse files"]}),(0,s.jsx)("input",{id:"file-upload",type:"file",className:"hidden",onChange:o,multiple:!0})]})};var g=r(8364),j=r(7381);function v(e,l){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return l<=0?"":e.length>l?"".concat(r).concat(e.slice(-l)):e}function b(e){if(0===e)return"0 Bytes";let l=Math.floor(Math.log(e)/Math.log(1024)),r=e/Math.pow(1024,l);return"".concat(r.toFixed(2)," ").concat(["Bytes","KB","MB","GB","TB"][l])}let w=e=>{let{files:l,removeFile:r}=e;return(0,s.jsx)("ul",{className:"space-y-4",children:l.map((e,l)=>(0,s.jsxs)("li",{className:"p-2 bg-gray-100 rounded shadow text-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium text-sm text-gray-700",children:v(e.file.name,12)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:b(e.file.size)})]}),(0,s.jsx)(n.T,{isIconOnly:!0,startContent:(0,s.jsx)(j.cW1,{className:"w-6 h-6"}),color:"danger",variant:"faded",onPress:()=>r(e.file.name),className:"p-0 min-w-0 w-auto h-auto rounded-full border-0"})]}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)(g.o,{"aria-label":"Loading...",size:"sm",value:e.progress}),(0,s.jsxs)("p",{className:"text-right text-xs text-gray-600",children:[e.progress,"%"]})]})]},l))})},N=()=>{let[e,l]=(0,t.useState)(!1),[r,a]=(0,t.useState)([]),[n,o]=(0,t.useState)(!1),i=(0,t.useRef)(0),c=e=>{a(l=>{let r=new Set(l.map(e=>e.file.name));return[...e.filter(e=>!r.has(e.name)).map(e=>({file:e,progress:0})),...l]})},d=(0,t.useRef)(new Map),h=async()=>{if(0===r.length)return;o(!0);let e=r.map(e=>e.isUploaded?Promise.resolve():new Promise((l,r)=>{let s=e.file;fetch("/api/get-file-name?originalName="+encodeURIComponent(s.name)).then(e=>e.json()).then(e=>{let t=new XMLHttpRequest;d.current.set(s.name,t),t.open("PUT","/api/upload-file?fileName="+e.filename,!0),t.upload.onprogress=function(l){if(l.lengthComputable){let r=l.loaded/l.total*100;a(l=>l.map(l=>l.file.name===s.name?{...l,progress:Math.round(r),serverFilename:e.filename}:l))}},t.onload=function(){d.current.delete(s.name),200===t.status?(console.log("File ".concat(s.name," uploaded successfully!")),a(e=>e.map(e=>e.file.name===s.name?{...e,isUploaded:!0}:e)),l()):(console.log("File ".concat(s.name," upload failed!")),r()),0===d.current.size&&o(!1)},t.onerror=function(){d.current.delete(s.name),console.log("Error occurred while uploading ".concat(s.name,".")),r(),0===d.current.size&&o(!1)},t.send(s)}).catch(e=>{console.error("Error preparing upload for ".concat(s.name,":"),e),r(),0===d.current.size&&o(!1)})}));try{await Promise.all(e),console.log("All files uploaded successfully!")}catch(e){console.error("Some files failed to upload:",e)}};return(0,s.jsxs)("div",{children:[(0,s.jsx)(u,{handleDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i.current+=1,l(!0)},handleDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i.current-=1,0===i.current&&l(!1)},handleDragOver:e=>{e.preventDefault(),e.stopPropagation()},handleDrop:e=>{e.preventDefault(),e.stopPropagation(),l(!1);let r=Array.from(e.dataTransfer.files);c(r),console.log("Dropped files:",r)},handleFileSelect:e=>{let l=Array.from(e.target.files||[]);c(l),console.log("Selected files:",l),e.target.value=""},isDragging:e}),(0,s.jsx)("div",{className:"mt-4 h-full overflow-y-auto",children:r.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w,{files:r,removeFile:e=>{let l=d.current.get(e);if(l){var s;l.abort(),d.current.delete(e),console.log("Upload for file ".concat(e," aborted."));let t=null===(s=r.find(l=>l.file.name===e))||void 0===s?void 0:s.serverFilename;t&&fetch("/api/upload-file?fileName="+encodeURIComponent(t),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(t," removed from the server.")):console.error("Failed to remove file ".concat(t," from the server."))}).catch(e=>{console.error("Error removing file ".concat(t," from the server:"),e)})}a(l=>{let r=l.filter(l=>l.file.name!==e);return(0===r.length||0===d.current.size)&&o(!1),r})}}),(0,s.jsx)(p,{handleUpload:h,clearUploadedFiles:()=>{a(e=>e.filter(e=>!e.isUploaded))},clearAllFiles:()=>{d.current.forEach((e,l)=>{var s;let t=null===(s=r.find(e=>e.file.name===l))||void 0===s?void 0:s.serverFilename;t&&fetch("/api/upload-file?fileName="+encodeURIComponent(t),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(t," removed from the server.")):console.error("Failed to remove file ".concat(t," from the server."))}).catch(e=>{console.error("Error removing file ".concat(t," from the server:"),e)}),e.abort()}),d.current.clear(),a([]),o(!1)},isUploading:n,selectedFiles:r})]})})]})},y=()=>(0,s.jsxs)("p",{className:"mt-2",children:["Visit our"," ",(0,s.jsx)("a",{href:"https://github.com/Mela-Digital/file-uploader/tags",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]}),k=e=>{let{currentVersion:l,latestVersion:r}=e,t=l<r,a=l>r;return(0,s.jsxs)(s.Fragment,{children:[t&&(0,s.jsxs)("div",{className:"bg-yellow-500 text-white p-4 text-center",children:[(0,s.jsxs)("p",{children:["A new version of the app is available! You are using version"," ",(0,s.jsx)("strong",{children:l}),", but the latest version is"," ",(0,s.jsx)("strong",{children:r}),"."]}),(0,s.jsx)(y,{})]}),a&&(0,s.jsxs)("div",{className:"bg-red-500 text-white p-4 text-center",children:[(0,s.jsxs)("p",{children:["You are using an invalid version of the app (",(0,s.jsx)("strong",{children:l}),"). Please reinstall the app to get the latest official version (",(0,s.jsx)("strong",{children:r}),")."]}),(0,s.jsx)(y,{})]})]})},E=e=>[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg"].includes(e.slice(e.lastIndexOf(".")).toLowerCase());var F=r(796);let D=e=>F.c9.fromISO(e).toRelative(),C=()=>{let[e,l]=(0,t.useState)([]),[r,i]=(0,t.useState)(1),[d,m]=(0,t.useState)(1),[f,p]=(0,t.useState)(h.version);(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("https://api.github.com/repos/Mela-Digital/file-uploader/tags");if(e.ok){let l=await e.json();l.length>0&&p(l[0].name)}else console.error("Failed to fetch the latest version")}catch(e){console.error("Error fetching the latest version:",e)}})()},[]),(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/files?page=".concat(r,"&limit=10"));if(e.ok){let r=await e.json();l(r.files),m(r.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()},[r]);let u=e=>{i(e)},g=async s=>{try{if((await fetch("/api/files/".concat(s),{method:"DELETE"})).ok){let t=e.filter(e=>e.name!==s);l(t),0===t.length&&r>1?i(r-1):(async()=>{try{let e=await fetch("/api/files?page=".concat(r,"&limit=10"));if(e.ok){let r=await e.json();l(r.files),m(r.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()}else console.error("Failed to delete file")}catch(e){console.error("Error deleting file:",e)}};return(0,s.jsxs)("div",{className:"bg-white h-screen flex flex-col overflow-hidden",children:[(0,s.jsx)(x,{}),(0,s.jsx)(k,{currentVersion:h.version,latestVersion:f}),(0,s.jsx)("div",{className:"flex-1 w-full xl:container mx-auto p-4 overflow-hidden",children:(0,s.jsxs)("div",{className:"flex h-full w-full rounded-lg overflow-hidden shadow-lg border border-gray-200 flex-col md:flex-row",children:[(0,s.jsxs)("div",{className:"w-full md:w-1/3 lg:w-1/4 p-4 border-b md:border-b-0 md:border-r border-gray-200 bg-gray-50 overflow-y-auto",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Upload Files"}),(0,s.jsx)(N,{})]}),(0,s.jsxs)("div",{className:"flex-1 p-4 bg-white overflow-y-auto",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Browse Your Files"}),(0,s.jsx)("ul",{className:"space-y-4",children:e.map((e,l)=>(0,s.jsxs)("li",{className:"p-3 bg-gray-100 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-200 gap-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 flex items-center justify-center",children:E(e.name)?(0,s.jsx)(a.W,{src:"/api/download/".concat(e.name),alt:"Preview image",className:"object-cover w-12 h-12",isZoomed:!0,radius:"sm"}):(0,s.jsx)("div",{className:"bg-gray-300 w-12 h-12 flex items-center justify-center rounded-sm border border-primary-300",children:(0,s.jsx)("p",{className:"text-xs font-bold text-primary-500",children:function(e){let l=e.split(".");return l.length>1&&l.pop()||""}(e.name)})})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium text-sm text-gray-700",children:v(e.name,12)}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:[b(e.size)," -"," ",D(e.createdAt)]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(n.T,{isIconOnly:!0,onPress:()=>g(e.name),color:"danger",children:(0,s.jsx)(o.Tqh,{className:"w-6 h-6"})}),(0,s.jsx)(n.T,{isIconOnly:!0,color:"primary",as:c(),href:"/api/download/".concat(e.name),rel:"noopener noreferrer",download:!0,children:(0,s.jsx)(o.kvS,{className:"w-6 h-6"})})]})]},l))}),!!e.length&&(0,s.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{r>1&&i(r-1)},disabled:1===r,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),(()=>{let e=[],l=Math.max(1,r-1),s=Math.min(d,r+1);for(let r=l;r<=s;r++)e.push(r);return e.length<3&&(e[0]>1?e.unshift(e[0]-1):e[e.length-1]<d&&e.push(e[e.length-1]+1)),e})().map(e=>(0,s.jsx)("button",{onClick:()=>u(e),className:"px-4 py-2 rounded ".concat(r===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e},e)),(0,s.jsx)("button",{onClick:()=>{r<d&&i(r+1)},disabled:r===d,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]})})]})}},9537:(e,l,r)=>{Promise.resolve().then(r.bind(r,7276))}},e=>{var l=l=>e(e.s=l);e.O(0,[789,581,148,52,963,7,223,429,358],()=>l(9537)),_N_E=e.O()}]);