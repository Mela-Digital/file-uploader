(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4019:(e,s,t)=>{Promise.resolve().then(t.bind(t,4154))},4154:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>M});var r=t(3776),l=t(5452),a=t(1392),o=t(659),n=t(9055),i=t(429),c=t.n(i);let d=JSON.parse('{"rE":"0.0.8","h_":"Support for multiple file types and sizes"}'),h={name:"File Uploader",description:d.h_,version:d.rE};var m=t(6829),f=t(4302);let p=()=>{let[e,s]=(0,l.useState)(!1),t=()=>{s(e=>!e)};return(0,r.jsxs)("header",{className:"bg-primary text-white",children:[(0,r.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(m.default,{src:"/images/file-uploader.png",alt:"Logo",width:32,height:32,className:"filter brightness-400"}),(0,r.jsx)("h1",{className:"text-xl font-bold",children:"File Uploader"})]}),(0,r.jsxs)("p",{className:"text-xs",children:["Version: ",h.version," by"," ",(0,r.jsx)("a",{className:"hover:underline font-bold",href:"https://github.com/Mela-Digital",target:"_blank",children:"@Mela Digital"})]})]}),(0,r.jsx)("nav",{className:"hidden md:flex space-x-4",children:(0,r.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,r.jsx)(f.hL4,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"GitHub"})]})}),(0,r.jsx)("button",{className:"md:hidden text-white focus:outline-none",onClick:t,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]}),(0,r.jsxs)("div",{className:"md:hidden fixed top-0 left-0 w-full h-full bg-primary text-white p-4 z-50 transform transition-transform duration-300 ".concat(e?"translate-x-0":"-translate-x-full"),children:[(0,r.jsx)("button",{className:"absolute top-4 right-4 text-white focus:outline-none",onClick:t,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,r.jsx)(f.hL4,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"GitHub"})]})]})]})},u=e=>{let{handleUpload:s,clearUploadedFiles:t,clearAllFiles:l,isUploading:a,selectedFiles:n}=e;return(0,r.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,r.jsx)(o.T,{onPress:s,isLoading:a,isDisabled:a||n.every(e=>e.isUploaded),color:"primary",startContent:(0,r.jsx)(f.HVe,{}),children:a?"Uploading...":"Upload"}),(0,r.jsx)(o.T,{color:"warning",startContent:(0,r.jsx)(f.Gml,{}),className:"text-white",onPress:t,children:"Clear Uploaded"}),(0,r.jsx)(o.T,{color:"danger",startContent:(0,r.jsx)(f.RCe,{}),onPress:l,children:"Clear All"})]})},x=e=>{let{isDragging:s,handleDragEnter:t,handleDragLeave:l,handleDragOver:a,handleDrop:o,handleFileSelect:n}=e;return(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto ".concat(s?"border-blue-500 bg-blue-100":"border-gray-300"),onDragEnter:t,onDragLeave:l,onDragOver:a,onDrop:o,children:[(0,r.jsx)("p",{className:"text-gray-600",children:s?"Drop files here...":"Drag and drop files here, or"}),(0,r.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500 hover:underline",children:[(0,r.jsx)("div",{className:"mx-auto my-4 w-16 h-16",children:(0,r.jsx)(m.default,{src:"/images/file-uploader.png",alt:"File upload illustration",width:64,height:64})}),"browse files"]}),(0,r.jsx)("input",{id:"file-upload",type:"file",className:"hidden",onChange:n,multiple:!0})]})};var g=t(6349),j=t(1701);let v=e=>e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase());function b(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return s<=0?"":e.length>s?"".concat(t).concat(e.slice(-s)):e}function w(e){if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024)),t=e/Math.pow(1024,s);return"".concat(t.toFixed(2)," ").concat(["Bytes","KB","MB","GB","TB"][s])}let y=e=>{let{files:s,removeFile:t}=e;return(0,r.jsx)("ul",{className:"space-y-4",children:s.map((e,s)=>(0,r.jsxs)("li",{className:"p-2 bg-gray-100 rounded shadow text-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"font-medium text-sm text-gray-700",children:b(e.file.name,12)}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:w(e.file.size)})]}),(0,r.jsx)(o.T,{isIconOnly:!0,startContent:(0,r.jsx)(j.cW1,{className:"w-6 h-6"}),color:"danger",variant:"faded",onPress:()=>t(e.file.name),className:"p-0 min-w-0 w-auto h-auto rounded-full border-0"})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)(g.o,{"aria-label":"Loading...",size:"sm",value:e.progress}),(0,r.jsxs)("p",{className:"text-right text-xs text-gray-600",children:[e.progress,"%"]})]})]},s))})},N=()=>{let[e,s]=(0,l.useState)(!1),[t,a]=(0,l.useState)([]),[o,n]=(0,l.useState)(!1),i=(0,l.useRef)(0),c=e=>{a(s=>{let t=new Set(s.map(e=>e.file.name));return[...e.filter(e=>!t.has(e.name)).map(e=>({file:e,progress:0})),...s]})},d=(0,l.useRef)(new Map),h=async()=>{if(0===t.length)return;n(!0);let e=t.map(e=>e.isUploaded?Promise.resolve():new Promise((s,t)=>{let r=e.file;fetch("/api/get-file-name?originalName="+encodeURIComponent(r.name)).then(e=>e.json()).then(e=>{let l=new XMLHttpRequest;d.current.set(r.name,l),l.open("PUT","/api/upload-file?fileName="+e.filename,!0),l.upload.onprogress=function(s){if(s.lengthComputable){let t=s.loaded/s.total*100;a(s=>s.map(s=>s.file.name===r.name?{...s,progress:Math.round(t),serverFilename:e.filename}:s))}},l.onload=function(){d.current.delete(r.name),200===l.status?(console.log("File ".concat(r.name," uploaded successfully!")),a(e=>e.map(e=>e.file.name===r.name?{...e,isUploaded:!0}:e)),s()):(console.log("File ".concat(r.name," upload failed!")),t()),0===d.current.size&&n(!1)},l.onerror=function(){d.current.delete(r.name),console.log("Error occurred while uploading ".concat(r.name,".")),t(),0===d.current.size&&n(!1)},l.send(r)}).catch(e=>{console.error("Error preparing upload for ".concat(r.name,":"),e),t(),0===d.current.size&&n(!1)})}));try{await Promise.all(e),console.log("All files uploaded successfully!")}catch(e){console.error("Some files failed to upload:",e)}};return(0,r.jsxs)("div",{children:[(0,r.jsx)(x,{handleDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i.current+=1,s(!0)},handleDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i.current-=1,0===i.current&&s(!1)},handleDragOver:e=>{e.preventDefault(),e.stopPropagation()},handleDrop:e=>{e.preventDefault(),e.stopPropagation(),s(!1);let t=Array.from(e.dataTransfer.files);c(t),console.log("Dropped files:",t)},handleFileSelect:e=>{let s=Array.from(e.target.files||[]);c(s),console.log("Selected files:",s),e.target.value=""},isDragging:e}),(0,r.jsx)("div",{className:"mt-4 h-full overflow-y-auto",children:t.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y,{files:t,removeFile:e=>{let s=d.current.get(e);if(s){var r;s.abort(),d.current.delete(e),console.log("Upload for file ".concat(e," aborted."));let l=null===(r=t.find(s=>s.file.name===e))||void 0===r?void 0:r.serverFilename;l&&fetch("/api/upload-file?fileName="+encodeURIComponent(l),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(l," removed from the server.")):console.error("Failed to remove file ".concat(l," from the server."))}).catch(e=>{console.error("Error removing file ".concat(l," from the server:"),e)})}a(s=>{let t=s.filter(s=>s.file.name!==e);return(0===t.length||0===d.current.size)&&n(!1),t})}}),(0,r.jsx)(u,{handleUpload:h,clearUploadedFiles:()=>{a(e=>e.filter(e=>!e.isUploaded))},clearAllFiles:()=>{d.current.forEach((e,s)=>{var r;let l=null===(r=t.find(e=>e.file.name===s))||void 0===r?void 0:r.serverFilename;l&&fetch("/api/upload-file?fileName="+encodeURIComponent(l),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(l," removed from the server.")):console.error("Failed to remove file ".concat(l," from the server."))}).catch(e=>{console.error("Error removing file ".concat(l," from the server:"),e)}),e.abort()}),d.current.clear(),a([]),n(!1)},isUploading:o,selectedFiles:t})]})})]})},k=()=>(0,r.jsxs)("p",{className:"mt-2",children:["Visit our"," ",(0,r.jsx)("a",{href:"https://github.com/Mela-Digital/file-uploader/tags",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]}),E=e=>{let{currentVersion:s,latestVersion:t}=e,l=s<t,a=s>t;return(0,r.jsxs)(r.Fragment,{children:[l&&(0,r.jsxs)("div",{className:"bg-yellow-500 text-white p-4 text-center",children:[(0,r.jsxs)("p",{children:["A new version of the app is available! You are using version"," ",(0,r.jsx)("strong",{children:s}),", but the latest version is"," ",(0,r.jsx)("strong",{children:t}),"."]}),(0,r.jsx)(k,{})]}),a&&(0,r.jsxs)("div",{className:"bg-red-500 text-white p-4 text-center",children:[(0,r.jsxs)("p",{children:["You are using an invalid version of the app (",(0,r.jsx)("strong",{children:s}),"). Please reinstall the app to get the latest official version (",(0,r.jsx)("strong",{children:t}),")."]}),(0,r.jsx)(k,{})]})]})};var D=t(9756);let F=e=>D.c9.fromISO(e).toRelative();var C=t(5928);let P=e=>{let s=e.toLowerCase();return[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(e=>s.endsWith(e))},M=()=>{let[e,s]=(0,l.useState)([]),[t,i]=(0,l.useState)(1),[d,m]=(0,l.useState)(1),[f,u]=(0,l.useState)(h.version),{hasPermission:x,permissions:g}=(0,l.useContext)(C.dg),j=x("delete");(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("https://api.github.com/repos/Mela-Digital/file-uploader/tags");if(e.ok){let s=await e.json();s.length>0&&u(s[0].name)}else console.error("Failed to fetch the latest version")}catch(e){console.error("Error fetching the latest version:",e)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/files?page=".concat(t,"&limit=10"));if(e.ok){let t=await e.json();s(t.files),m(t.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()},[t]);let y=e=>{i(e)},k=async r=>{try{if((await fetch("/api/files/".concat(r),{method:"DELETE"})).ok){let l=e.filter(e=>e.name!==r);s(l),0===l.length&&t>1?i(t-1):(async()=>{try{let e=await fetch("/api/files?page=".concat(t,"&limit=10"));if(e.ok){let t=await e.json();s(t.files),m(t.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()}else console.error("Failed to delete file")}catch(e){console.error("Error deleting file:",e)}};return(0,r.jsxs)("div",{className:"bg-white h-screen flex flex-col overflow-hidden",children:[(0,r.jsx)(p,{}),(0,r.jsx)(E,{currentVersion:h.version,latestVersion:f}),(0,r.jsx)("div",{className:"container px-4 mx-auto my-4",children:(0,r.jsxs)("p",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Your permissions:"})," ".concat(g.map(e=>v(e)).join(", "))]})}),(0,r.jsx)("div",{className:"flex-1 w-full xl:container mx-auto p-4 overflow-hidden",children:(0,r.jsxs)("div",{className:"flex h-full w-full rounded-lg overflow-hidden shadow-lg border border-gray-200 flex-col md:flex-row",children:[(0,r.jsxs)("div",{className:"w-full md:w-1/3 lg:w-1/4 p-4 border-b md:border-b-0 md:border-r border-gray-200 bg-gray-50 overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Upload Files"}),(0,r.jsx)(N,{})]}),(0,r.jsxs)("div",{className:"flex-1 p-4 bg-white overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Browse Your Files"}),(0,r.jsx)("ul",{className:"space-y-4",children:e.map((e,s)=>(0,r.jsxs)("li",{className:"p-4 bg-gray-100 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-200 gap-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[P(e.name)?(0,r.jsx)("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 rounded-md",children:(0,r.jsx)(a.W,{className:"w-12 h-12 object-cover",isZoomed:!0,radius:"md",src:"/api/download/".concat(e.name),alt:"Preview image"})}):(0,r.jsx)("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 rounded-md border border-primary-200 group",children:(0,r.jsx)("p",{className:"text-xs font-bold text-primary-500 group-hover:scale-125 group-hover:duration-300 transform",children:function(e){let s=e.split(".");return s.length>1&&s.pop()||""}(e.name)})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"font-medium text-sm text-gray-700",children:b(e.name,12)}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:[w(e.size)," -"," ",F(e.createdAt)]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(o.T,{isIconOnly:!0,isDisabled:!j,onPress:j?()=>k(e.name):void 0,color:"danger",children:(0,r.jsx)(n.Tqh,{className:"w-6 h-6"})}),(0,r.jsx)(o.T,{isIconOnly:!0,color:"primary",as:c(),href:"/api/download/".concat(e.name),rel:"noopener noreferrer",download:!0,children:(0,r.jsx)(n.kvS,{className:"w-6 h-6"})})]})]},s))}),!!e.length&&(0,r.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{t>1&&i(t-1)},disabled:1===t,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),(()=>{let e=[],s=Math.max(1,t-1),r=Math.min(d,t+1);for(let t=s;t<=r;t++)e.push(t);return e.length<3&&(e[0]>1?e.unshift(e[0]-1):e[e.length-1]<d&&e.push(e[e.length-1]+1)),e})().map(e=>(0,r.jsx)("button",{onClick:()=>y(e),className:"px-4 py-2 rounded ".concat(t===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e},e)),(0,r.jsx)("button",{onClick:()=>{t<d&&i(t+1)},disabled:t===d,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]})})]})}},5928:(e,s,t)=>{"use strict";t.d(s,{XI:()=>i,dg:()=>a});var r=t(3776),l=t(5452);let a=(0,l.createContext)({hasPermission:()=>!1,setPermissions:()=>{},permissions:[]}),o=["upload","delete","view"],n=e=>(Array.isArray(e)||(e=[e]),o.filter(s=>!e.includes(s))),i=e=>{let{children:s}=e,[t,o]=(0,l.useState)([]),i=e=>{o(e)};return(0,l.useEffect)(()=>{let e="http://localhost:".concat(document.location.port,"/api/connect");(async()=>{try{let s=await fetch(e);(await s.json()).ok&&i(n([]))}catch(e){console.log(e.stack),i(n(["delete"]))}})()},[]),(0,r.jsx)(a.Provider,{value:{hasPermission:e=>t.includes(e),setPermissions:i,permissions:t},children:s})}}},e=>{var s=s=>e(e.s=s);e.O(0,[789,581,148,52,992,567,736,835,358],()=>s(4019)),_N_E=e.O()}]);