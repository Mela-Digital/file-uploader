(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9381:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>p});var r=t(2694),a=t(3478),s=t(3431);let o=JSON.parse('{"rE":"0.0.3","h_":"Support for multiple file types and sizes"}'),n={name:"File Uploader",description:o.h_,version:o.rE},i=()=>{let[e,l]=(0,a.useState)(!1),t=()=>{l(e=>!e)};return(0,r.jsxs)("header",{className:"bg-primary text-white",children:[(0,r.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(s.default,{src:"/images/file-uploader.png",alt:"Logo",width:32,height:32,className:"filter brightness-400"}),(0,r.jsx)("h1",{className:"text-xl font-bold",children:"File Uploader"})]}),(0,r.jsxs)("p",{className:"text-xs",children:["Version: ",n.version," by"," ",(0,r.jsx)("a",{className:"hover:underline font-bold",href:"https://github.com/Mela-Digital",target:"_blank",children:"@Mela Digital"})]})]}),(0,r.jsx)("nav",{className:"hidden md:flex space-x-4",children:(0,r.jsx)("a",{href:"#",className:"hover:underline",children:"GitHub"})}),(0,r.jsx)("button",{className:"md:hidden text-white focus:outline-none",onClick:t,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]}),(0,r.jsxs)("div",{className:"md:hidden fixed top-0 left-0 w-full h-full bg-primary text-white p-4 z-50 transform transition-transform duration-300 ".concat(e?"translate-x-0":"-translate-x-full"),children:[(0,r.jsx)("button",{className:"absolute top-4 right-4 text-white focus:outline-none",onClick:t,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsx)("a",{href:"https://github.com/Mela-Digital",className:"block hover:underline",target:"_blank",children:"GitHub"})]})]})},c=e=>{let{handleUpload:l,clearUploadedFiles:t,clearAllFiles:a,isUploading:s,selectedFiles:o}=e;return(0,r.jsxs)("div",{className:"mt-4 flex gap-4",children:[(0,r.jsx)("button",{onClick:l,disabled:s||o.every(e=>e.isUploaded),className:"px-4 py-2 rounded ".concat(s||o.every(e=>e.isUploaded)?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white"),children:s?"Uploading...":"Upload"}),(0,r.jsx)("button",{onClick:t,className:"px-4 py-2 rounded bg-yellow-500 hover:bg-yellow-600 text-white",children:"Clear Uploaded Files"}),(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 rounded bg-red-500 hover:bg-red-600 text-white",children:"Clear All Files"})]})},d=e=>{let{isDragging:l,handleDragEnter:t,handleDragLeave:a,handleDragOver:o,handleDrop:n,handleFileSelect:i}=e;return(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto ".concat(l?"border-blue-500 bg-blue-100":"border-gray-300"),onDragEnter:t,onDragLeave:a,onDragOver:o,onDrop:n,children:[(0,r.jsx)("p",{className:"text-gray-600",children:l?"Drop files here...":"Drag and drop files here, or"}),(0,r.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500 hover:underline",children:[(0,r.jsx)("div",{className:"mx-auto my-4 w-16 h-16",children:(0,r.jsx)(s.default,{src:"/images/file-uploader.png",alt:"File upload illustration",width:64,height:64})}),"browse files"]}),(0,r.jsx)("input",{id:"file-upload",type:"file",className:"hidden",onChange:i,multiple:!0})]})},h=e=>{let{files:l,removeFile:t}=e;return(0,r.jsx)("ul",{className:"space-y-4",children:l.map((e,l)=>(0,r.jsxs)("li",{className:"p-2 bg-gray-100 rounded shadow text-gray-700",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:e.file.name}),(0,r.jsx)("button",{onClick:()=>t(e.file.name),className:"text-red-500 hover:text-red-700",children:"Remove"})]}),(0,r.jsx)("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-4",children:(0,r.jsx)("div",{className:"bg-blue-500 h-4 rounded-full",style:{width:"".concat(e.progress,"%")}})}),(0,r.jsxs)("div",{className:"text-right text-sm text-gray-600",children:[e.progress,"%"]})]},l))})},u=()=>{let[e,l]=(0,a.useState)(!1),[t,s]=(0,a.useState)([]),[o,n]=(0,a.useState)(!1),i=(0,a.useRef)(0),u=e=>{s(l=>{let t=new Set(l.map(e=>e.file.name));return[...l,...e.filter(e=>!t.has(e.name)).map(e=>({file:e,progress:0}))]})},f=(0,a.useRef)(new Map),p=async()=>{if(0===t.length)return;n(!0);let e=t.map(e=>e.isUploaded?Promise.resolve():new Promise((l,t)=>{let r=e.file;fetch("/api/get-file-name?originalName="+encodeURIComponent(r.name)).then(e=>e.json()).then(e=>{let a=new XMLHttpRequest;f.current.set(r.name,a),a.open("PUT","/api/upload-file?fileName="+e.filename,!0),a.upload.onprogress=function(l){if(l.lengthComputable){let t=l.loaded/l.total*100;s(l=>l.map(l=>l.file.name===r.name?{...l,progress:Math.round(t),serverFilename:e.filename}:l))}},a.onload=function(){f.current.delete(r.name),200===a.status?(console.log("File ".concat(r.name," uploaded successfully!")),s(e=>e.map(e=>e.file.name===r.name?{...e,isUploaded:!0}:e)),l()):(console.log("File ".concat(r.name," upload failed!")),t()),0===f.current.size&&n(!1)},a.onerror=function(){f.current.delete(r.name),console.log("Error occurred while uploading ".concat(r.name,".")),t(),0===f.current.size&&n(!1)},a.send(r)}).catch(e=>{console.error("Error preparing upload for ".concat(r.name,":"),e),t(),0===f.current.size&&n(!1)})}));try{await Promise.all(e),console.log("All files uploaded successfully!")}catch(e){console.error("Some files failed to upload:",e)}};return(0,r.jsxs)("div",{children:[(0,r.jsx)(d,{handleDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i.current+=1,l(!0)},handleDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i.current-=1,0===i.current&&l(!1)},handleDragOver:e=>{e.preventDefault(),e.stopPropagation()},handleDrop:e=>{e.preventDefault(),e.stopPropagation(),l(!1);let t=Array.from(e.dataTransfer.files);u(t),console.log("Dropped files:",t)},handleFileSelect:e=>{let l=Array.from(e.target.files||[]);u(l),console.log("Selected files:",l),e.target.value=""},isDragging:e}),(0,r.jsx)("div",{className:"mt-4 h-full overflow-y-auto",children:t.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h,{files:t,removeFile:e=>{let l=f.current.get(e);if(l){var r;l.abort(),f.current.delete(e),console.log("Upload for file ".concat(e," aborted."));let a=null===(r=t.find(l=>l.file.name===e))||void 0===r?void 0:r.serverFilename;a&&fetch("/api/upload-file?fileName="+encodeURIComponent(a),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(a," removed from the server.")):console.error("Failed to remove file ".concat(a," from the server."))}).catch(e=>{console.error("Error removing file ".concat(a," from the server:"),e)})}s(l=>{let t=l.filter(l=>l.file.name!==e);return(0===t.length||0===f.current.size)&&n(!1),t})}}),(0,r.jsx)(c,{handleUpload:p,clearUploadedFiles:()=>{s(e=>e.filter(e=>!e.isUploaded))},clearAllFiles:()=>{f.current.forEach((e,l)=>{var r;let a=null===(r=t.find(e=>e.file.name===l))||void 0===r?void 0:r.serverFilename;a&&fetch("/api/upload-file?fileName="+encodeURIComponent(a),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(a," removed from the server.")):console.error("Failed to remove file ".concat(a," from the server."))}).catch(e=>{console.error("Error removing file ".concat(a," from the server:"),e)}),e.abort()}),f.current.clear(),s([]),n(!1)},isUploading:o,selectedFiles:t})]})})]})},f=e=>{let{currentVersion:l,latestVersion:t}=e,a=l<t,s=l>t;return(0,r.jsxs)(r.Fragment,{children:[a&&(0,r.jsxs)("div",{className:"bg-yellow-500 text-white p-4 text-center",children:[(0,r.jsxs)("p",{children:["A new version of the app is available! You are using version"," ",(0,r.jsx)("strong",{children:l}),", but the latest version is"," ",(0,r.jsx)("strong",{children:t}),"."]}),(0,r.jsx)("a",{href:"https://github.com/Mela-Digital",target:"_blank",className:"underline font-bold",children:"Click here to update."}),(0,r.jsxs)("p",{className:"mt-2",children:["Visit our"," ",(0,r.jsx)("a",{href:"https://github.com/Mela-Digital",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]})]}),s&&(0,r.jsxs)("div",{className:"bg-red-500 text-white p-4 text-center",children:[(0,r.jsxs)("p",{children:["You are using an invalid version of the app (",(0,r.jsx)("strong",{children:l}),"). Please reinstall the app to get the latest official version (",(0,r.jsx)("strong",{children:t}),")."]}),(0,r.jsxs)("p",{className:"mt-2",children:["Visit our"," ",(0,r.jsx)("a",{href:"https://github.com/Mela-Digital",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]})]})]})},p=()=>{let[e,l]=(0,a.useState)([]),[t,s]=(0,a.useState)(1),[o,c]=(0,a.useState)(1),[d,h]=(0,a.useState)(n.version);(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("https://api.github.com/repos/Mela-Digital/file-uploader/tags");if(e.ok){let l=await e.json();l.length>0&&h(l[0].name)}else console.error("Failed to fetch the latest version")}catch(e){console.error("Error fetching the latest version:",e)}})()},[]),(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/files?page=".concat(t,"&limit=10"));if(e.ok){let t=await e.json();l(t.files),c(t.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()},[t]);let p=e=>{s(e)},m=async r=>{try{if((await fetch("/api/files/".concat(r),{method:"DELETE"})).ok){let a=e.filter(e=>e!==r);l(a),0===a.length&&t>1?s(t-1):(async()=>{try{let e=await fetch("/api/files?page=".concat(t,"&limit=10"));if(e.ok){let t=await e.json();l(t.files),c(t.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()}else console.error("Failed to delete file")}catch(e){console.error("Error deleting file:",e)}};return(0,r.jsxs)("div",{className:"bg-white h-screen flex flex-col overflow-hidden",children:[(0,r.jsx)(i,{}),(0,r.jsx)(f,{currentVersion:n.version,latestVersion:d}),(0,r.jsx)("div",{className:"flex-1 container mx-auto p-4 overflow-hidden",children:(0,r.jsxs)("div",{className:"flex h-full w-full rounded-lg overflow-hidden shadow-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"w-1/4 p-4 border-r border-gray-200 bg-gray-50 overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Upload Files"}),(0,r.jsx)(u,{})]}),(0,r.jsxs)("div",{className:"flex-1 p-4 bg-white overflow-y-auto",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Browse Your Files"}),(0,r.jsx)("ul",{className:"space-y-4",children:e.map((e,l)=>(0,r.jsxs)("li",{className:"p-4 bg-gray-100 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-200",children:[(0,r.jsx)("span",{className:"font-medium text-gray-700",children:e}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>m(e),className:"px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"Delete"}),(0,r.jsx)("a",{href:"/api/download/".concat(e),rel:"noopener noreferrer",className:"px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-center",download:!0,children:"Download"})]})]},l))}),!!e.length&&(0,r.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{t>1&&s(t-1)},disabled:1===t,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),(()=>{let e=[],l=Math.max(1,t-1),r=Math.min(o,t+1);for(let t=l;t<=r;t++)e.push(t);return e.length<3&&(e[0]>1?e.unshift(e[0]-1):e[e.length-1]<o&&e.push(e[e.length-1]+1)),e})().map(e=>(0,r.jsx)("button",{onClick:()=>p(e),className:"px-4 py-2 rounded ".concat(t===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e},e)),(0,r.jsx)("button",{onClick:()=>{t<o&&s(t+1)},disabled:t===o,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]})})]})}},9537:(e,l,t)=>{Promise.resolve().then(t.bind(t,9381))}},e=>{var l=l=>e(e.s=l);e.O(0,[431,223,429,358],()=>l(9537)),_N_E=e.O()}]);