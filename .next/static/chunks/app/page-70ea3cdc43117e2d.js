(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3288:(e,l,r)=>{"use strict";r.r(l),r.d(l,{default:()=>F});var t=r(2694),s=r(3478),a=r(8260),n=r(7087),o=r(7515),i=r.n(o);let c=JSON.parse('{"rE":"0.0.4","h_":"Support for multiple file types and sizes"}'),d={name:"File Uploader",description:c.h_,version:c.rE};var h=r(3431),m=r(9630);let f=()=>{let[e,l]=(0,s.useState)(!1),r=()=>{l(e=>!e)};return(0,t.jsxs)("header",{className:"bg-primary text-white",children:[(0,t.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.default,{src:"/images/file-uploader.png",alt:"Logo",width:32,height:32,className:"filter brightness-400"}),(0,t.jsx)("h1",{className:"text-xl font-bold",children:"File Uploader"})]}),(0,t.jsxs)("p",{className:"text-xs",children:["Version: ",d.version," by"," ",(0,t.jsx)("a",{className:"hover:underline font-bold",href:"https://github.com/Mela-Digital",target:"_blank",children:"@Mela Digital"})]})]}),(0,t.jsx)("nav",{className:"hidden md:flex space-x-4",children:(0,t.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,t.jsx)(m.hL4,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"GitHub"})]})}),(0,t.jsx)("button",{className:"md:hidden text-white focus:outline-none",onClick:r,children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})]}),(0,t.jsxs)("div",{className:"md:hidden fixed top-0 left-0 w-full h-full bg-primary text-white p-4 z-50 transform transition-transform duration-300 ".concat(e?"translate-x-0":"-translate-x-full"),children:[(0,t.jsx)("button",{className:"absolute top-4 right-4 text-white focus:outline-none",onClick:r,children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsxs)("a",{href:"https://github.com/Mela-Digital",className:"hover:underline flex items-center space-x-2",target:"_blank",children:[(0,t.jsx)(m.hL4,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"GitHub"})]})]})]})},x=e=>{let{handleUpload:l,clearUploadedFiles:r,clearAllFiles:s,isUploading:n,selectedFiles:o}=e;return(0,t.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,t.jsx)(a.T,{onPress:l,isLoading:n,isDisabled:n||o.every(e=>e.isUploaded),color:"primary",startContent:(0,t.jsx)(m.HVe,{}),children:n?"Uploading...":"Upload"}),(0,t.jsx)(a.T,{color:"warning",startContent:(0,t.jsx)(m.Gml,{}),className:"text-white",onPress:r,children:"Clear Uploaded"}),(0,t.jsx)(a.T,{color:"danger",startContent:(0,t.jsx)(m.RCe,{}),onPress:s,children:"Clear All"})]})},p=e=>{let{isDragging:l,handleDragEnter:r,handleDragLeave:s,handleDragOver:a,handleDrop:n,handleFileSelect:o}=e;return(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-all min-w-[196px] max-w-[400px] mx-auto ".concat(l?"border-blue-500 bg-blue-100":"border-gray-300"),onDragEnter:r,onDragLeave:s,onDragOver:a,onDrop:n,children:[(0,t.jsx)("p",{className:"text-gray-600",children:l?"Drop files here...":"Drag and drop files here, or"}),(0,t.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500 hover:underline",children:[(0,t.jsx)("div",{className:"mx-auto my-4 w-16 h-16",children:(0,t.jsx)(h.default,{src:"/images/file-uploader.png",alt:"File upload illustration",width:64,height:64})}),"browse files"]}),(0,t.jsx)("input",{id:"file-upload",type:"file",className:"hidden",onChange:o,multiple:!0})]})};var u=r(8364),g=r(7381);function j(e,l){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return l<=0?"":e.length>l?"".concat(r).concat(e.slice(-l)):e}function v(e){if(0===e)return"0 Bytes";let l=Math.floor(Math.log(e)/Math.log(1024)),r=e/Math.pow(1024,l);return"".concat(r.toFixed(2)," ").concat(["Bytes","KB","MB","GB","TB"][l])}let b=e=>{let{files:l,removeFile:r}=e;return(0,t.jsx)("ul",{className:"space-y-4",children:l.map((e,l)=>(0,t.jsxs)("li",{className:"p-2 bg-gray-100 rounded shadow text-gray-700",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-sm text-gray-700",children:j(e.file.name,12)}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:v(e.file.size)})]}),(0,t.jsx)(a.T,{isIconOnly:!0,startContent:(0,t.jsx)(g.cW1,{className:"w-6 h-6"}),color:"danger",variant:"faded",onPress:()=>r(e.file.name),className:"p-0 min-w-0 w-auto h-auto rounded-full border-0"})]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)(u.o,{"aria-label":"Loading...",size:"sm",value:e.progress}),(0,t.jsxs)("p",{className:"text-right text-xs text-gray-600",children:[e.progress,"%"]})]})]},l))})},w=()=>{let[e,l]=(0,s.useState)(!1),[r,a]=(0,s.useState)([]),[n,o]=(0,s.useState)(!1),i=(0,s.useRef)(0),c=e=>{a(l=>{let r=new Set(l.map(e=>e.file.name));return[...e.filter(e=>!r.has(e.name)).map(e=>({file:e,progress:0})),...l]})},d=(0,s.useRef)(new Map),h=async()=>{if(0===r.length)return;o(!0);let e=r.map(e=>e.isUploaded?Promise.resolve():new Promise((l,r)=>{let t=e.file;fetch("/api/get-file-name?originalName="+encodeURIComponent(t.name)).then(e=>e.json()).then(e=>{let s=new XMLHttpRequest;d.current.set(t.name,s),s.open("PUT","/api/upload-file?fileName="+e.filename,!0),s.upload.onprogress=function(l){if(l.lengthComputable){let r=l.loaded/l.total*100;a(l=>l.map(l=>l.file.name===t.name?{...l,progress:Math.round(r),serverFilename:e.filename}:l))}},s.onload=function(){d.current.delete(t.name),200===s.status?(console.log("File ".concat(t.name," uploaded successfully!")),a(e=>e.map(e=>e.file.name===t.name?{...e,isUploaded:!0}:e)),l()):(console.log("File ".concat(t.name," upload failed!")),r()),0===d.current.size&&o(!1)},s.onerror=function(){d.current.delete(t.name),console.log("Error occurred while uploading ".concat(t.name,".")),r(),0===d.current.size&&o(!1)},s.send(t)}).catch(e=>{console.error("Error preparing upload for ".concat(t.name,":"),e),r(),0===d.current.size&&o(!1)})}));try{await Promise.all(e),console.log("All files uploaded successfully!")}catch(e){console.error("Some files failed to upload:",e)}};return(0,t.jsxs)("div",{children:[(0,t.jsx)(p,{handleDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i.current+=1,l(!0)},handleDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i.current-=1,0===i.current&&l(!1)},handleDragOver:e=>{e.preventDefault(),e.stopPropagation()},handleDrop:e=>{e.preventDefault(),e.stopPropagation(),l(!1);let r=Array.from(e.dataTransfer.files);c(r),console.log("Dropped files:",r)},handleFileSelect:e=>{let l=Array.from(e.target.files||[]);c(l),console.log("Selected files:",l),e.target.value=""},isDragging:e}),(0,t.jsx)("div",{className:"mt-4 h-full overflow-y-auto",children:r.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b,{files:r,removeFile:e=>{let l=d.current.get(e);if(l){var t;l.abort(),d.current.delete(e),console.log("Upload for file ".concat(e," aborted."));let s=null===(t=r.find(l=>l.file.name===e))||void 0===t?void 0:t.serverFilename;s&&fetch("/api/upload-file?fileName="+encodeURIComponent(s),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(s," removed from the server.")):console.error("Failed to remove file ".concat(s," from the server."))}).catch(e=>{console.error("Error removing file ".concat(s," from the server:"),e)})}a(l=>{let r=l.filter(l=>l.file.name!==e);return(0===r.length||0===d.current.size)&&o(!1),r})}}),(0,t.jsx)(x,{handleUpload:h,clearUploadedFiles:()=>{a(e=>e.filter(e=>!e.isUploaded))},clearAllFiles:()=>{d.current.forEach((e,l)=>{var t;let s=null===(t=r.find(e=>e.file.name===l))||void 0===t?void 0:t.serverFilename;s&&fetch("/api/upload-file?fileName="+encodeURIComponent(s),{method:"DELETE"}).then(e=>{e.ok?console.log("File ".concat(s," removed from the server.")):console.error("Failed to remove file ".concat(s," from the server."))}).catch(e=>{console.error("Error removing file ".concat(s," from the server:"),e)}),e.abort()}),d.current.clear(),a([]),o(!1)},isUploading:n,selectedFiles:r})]})})]})},N=()=>(0,t.jsxs)("p",{className:"mt-2",children:["Visit our"," ",(0,t.jsx)("a",{href:"https://github.com/Mela-Digital/file-uploader/tags",target:"_blank",className:"underline font-bold",children:"GitHub page"})," ","for the latest updates and releases."]}),y=e=>{let{currentVersion:l,latestVersion:r}=e,s=l<r,a=l>r;return(0,t.jsxs)(t.Fragment,{children:[s&&(0,t.jsxs)("div",{className:"bg-yellow-500 text-white p-4 text-center",children:[(0,t.jsxs)("p",{children:["A new version of the app is available! You are using version"," ",(0,t.jsx)("strong",{children:l}),", but the latest version is"," ",(0,t.jsx)("strong",{children:r}),"."]}),(0,t.jsx)(N,{})]}),a&&(0,t.jsxs)("div",{className:"bg-red-500 text-white p-4 text-center",children:[(0,t.jsxs)("p",{children:["You are using an invalid version of the app (",(0,t.jsx)("strong",{children:l}),"). Please reinstall the app to get the latest official version (",(0,t.jsx)("strong",{children:r}),")."]}),(0,t.jsx)(N,{})]})]})};var k=r(796);let E=e=>k.c9.fromISO(e).toRelative(),F=()=>{let[e,l]=(0,s.useState)([]),[r,o]=(0,s.useState)(1),[c,h]=(0,s.useState)(1),[m,x]=(0,s.useState)(d.version);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("https://api.github.com/repos/Mela-Digital/file-uploader/tags");if(e.ok){let l=await e.json();l.length>0&&x(l[0].name)}else console.error("Failed to fetch the latest version")}catch(e){console.error("Error fetching the latest version:",e)}})()},[]),(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/files?page=".concat(r,"&limit=10"));if(e.ok){let r=await e.json();l(r.files),h(r.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()},[r]);let p=e=>{o(e)},u=async t=>{try{if((await fetch("/api/files/".concat(t),{method:"DELETE"})).ok){let s=e.filter(e=>e.name!==t);l(s),0===s.length&&r>1?o(r-1):(async()=>{try{let e=await fetch("/api/files?page=".concat(r,"&limit=10"));if(e.ok){let r=await e.json();l(r.files),h(r.totalPages)}else console.error("Failed to fetch files")}catch(e){console.error("Error fetching files:",e)}})()}else console.error("Failed to delete file")}catch(e){console.error("Error deleting file:",e)}};return(0,t.jsxs)("div",{className:"bg-white h-screen flex flex-col overflow-hidden",children:[(0,t.jsx)(f,{}),(0,t.jsx)(y,{currentVersion:d.version,latestVersion:m}),(0,t.jsx)("div",{className:"flex-1 w-full xl:container mx-auto p-4 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex h-full w-full rounded-lg overflow-hidden shadow-lg border border-gray-200 flex-col md:flex-row",children:[(0,t.jsxs)("div",{className:"w-full md:w-1/3 lg:w-1/4 p-4 border-b md:border-b-0 md:border-r border-gray-200 bg-gray-50 overflow-y-auto",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-800",children:"Upload Files"}),(0,t.jsx)(w,{})]}),(0,t.jsxs)("div",{className:"flex-1 p-4 bg-white overflow-y-auto",children:[(0,t.jsx)("h2",{className:"text-lg font-bold mb-4 text-gray-800",children:"Browse Your Files"}),(0,t.jsx)("ul",{className:"space-y-4",children:e.map((e,l)=>(0,t.jsxs)("li",{className:"p-4 bg-gray-100 rounded-lg shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-200 gap-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,t.jsx)("div",{className:"w-10 h-10 flex items-center justify-center bg-gray-200 rounded border border-primary-300",children:(0,t.jsx)("p",{className:"text-xs font-bold text-primary-500",children:function(e){let l=e.split(".");return l.length>1&&l.pop()||""}(e.name)})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-sm text-gray-700",children:j(e.name,12)}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[v(e.size)," -"," ",E(e.createdAt)]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(a.T,{isIconOnly:!0,onPress:()=>u(e.name),color:"danger",children:(0,t.jsx)(n.Tqh,{className:"w-6 h-6"})}),(0,t.jsx)(a.T,{isIconOnly:!0,color:"primary",as:i(),href:"/api/download/".concat(e.name),rel:"noopener noreferrer",download:!0,children:(0,t.jsx)(n.kvS,{className:"w-6 h-6"})})]})]},l))}),!!e.length&&(0,t.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,t.jsx)("button",{onClick:()=>{r>1&&o(r-1)},disabled:1===r,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),(()=>{let e=[],l=Math.max(1,r-1),t=Math.min(c,r+1);for(let r=l;r<=t;r++)e.push(r);return e.length<3&&(e[0]>1?e.unshift(e[0]-1):e[e.length-1]<c&&e.push(e[e.length-1]+1)),e})().map(e=>(0,t.jsx)("button",{onClick:()=>p(e),className:"px-4 py-2 rounded ".concat(r===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:e},e)),(0,t.jsx)("button",{onClick:()=>{r<c&&o(r+1)},disabled:r===c,className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]})})]})}},9537:(e,l,r)=>{Promise.resolve().then(r.bind(r,3288))}},e=>{var l=l=>e(e.s=l);e.O(0,[789,581,148,52,963,16,223,429,358],()=>l(9537)),_N_E=e.O()}]);